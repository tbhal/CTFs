# Loggy
## Malware Analysis Challenge HTB

- Question 1: What is the SHA-256 hash of this malware binary?\
*Answer*: For this purpose we can use `sha256sum` binary in linux or `Get-FileHash -Algorithm`, or gui tool like PEStudio.\
![sha256](/malware_analysis/loggy/loggy-POC-images/sha256-strings.png)

- Question 2: What programming language (and version) is this malware written in?\
*Answer*: This we can check using the strings command, we are going to store the result of the strings command then search on it. There are multiple questions that we can answer using the same. PEStudeio can also be used for doing the same.\
```bash
strings Loggy.exe > strings_res
vim strings_res
/go1 #searching for this value and then navigating a little we'll get our response
```
![golang](/malware_analysis/loggy/loggy-POC-images/go-res.png)
- Qusetion 3: There are multiple GitHub repos referenced in the static strings. Which GitHub repo would be most likely suggest the ability of this malware to exfiltrate data?\
*Answer*: For we are asked to find links for github repo. so we in the same strings_res file we can search for github. Once we do that we'll see multiple github respos and there we'll see one which is having ftp at end which fits for the descritption mentioned in the question.
![exfil](/malware_analysis/loggy/loggy-POC-images/github-exfil.png)

- Question 4: What dependency, expressed as a GitHub repo, supports Janice’s assertion that she thought she downloaded something that can just take screenshots?\
*Answer*: In the above question when we searched for the github respos there we can see answer for this question as well. Jessica downloaded something that take screenshot. We see one repo that is to a screenshot taking tool.
![screenshot](/malware_analysis/loggy/loggy-POC-images/github-screenshot.png)

- Question 5: Which function call suggests that the malware produces a file after execution?\
*Answer*: For this Question in PEStudio we can check for the functions that the binray is using. File creation will require creation and writing in file. This is done using a system function **WriteFile**. For finding the same in the strings_res file we'll use `grep`
```bash
grep -A 5 -B 5 "File" strings_res
# -A -B are for searching 5 characters before and after the "File" string
```

From here onwards we are going to do advanced static analysis and a little dynamic analysis as well.\
We have opened the binary in cutter as well as Ghidra for doing our static analysis part.\

- Question 6: You observe that the malware is exfiltrating data over FTP. What is the domain it is exfiltrating data to?\
*Answer*: When viewing the response in cutter there is a function named sendFilesViaFTP. This was interesting as our question is asking about data exfiltration. When navigating in this function we can observe a server mentioned after a jump instruction. There is call that is being made to the ftp funtion after mentioning the exfiltration server.
![ftp](/malware_analysis/loggy/loggy-POC-images/sendFilesFTP-domain.png)

- Question 7: What are the threat actor’s credentials?\
*Answer*: For getting this there are two ways, first is we check the sendFilesViaFTP function properly using the dissammbler and decompilers. We not that there is a login function which takes in the username and password in string format.\
By using Ghidra and cutter we were able to see those creds easily.\
Other method is to use x64dbg to debug the executable and put breakpoint on the function starting address. And when we reach that login function we'll see the credentials being passed.
![login-func](/malware_analysis/loggy/loggy-POC-images/login-function.png)
![login-func-cutter](/malware_analysis/loggy/loggy-POC-images/login-function-cutter.png)
![login-func-user](/malware_analysis/loggy/loggy-POC-images/sendFileViaFTP-username-pass.png)
![ghidra](/malware_analysis/loggy/loggy-POC-images/plain-text-userid-password.png)

- Question 8: What file keeps getting written to disk?\
*Answer*: This we can see by running the binary in a controlled environment. The file keeps getting created on the Desktop. The file name is **keylog.txt**.

- Question 9: When Janice changed her password, this was captured in a file. What is Janice's username and password?\
*Answer*: This we can solve by seeing the keylog.txt that has been provided to us in the challenge zip file. The response is **janice:Password123**
![keylog](/malware_analysis/loggy/loggy-POC-images/keystrokes.png)

- Question 10: What app did Janice have open the last time she ran the "screenshot app"?\
*Answer*: This again we can see from the files that we got from the challenge. The response is **Solitaire**.
