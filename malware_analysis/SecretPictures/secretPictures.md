# SecretPictures

### Sherlock Scenario
The university's IT team began receiving reports of strange activity on library computers. Students noticed hidden files appearing on their USB drives and disappearing moments later. An investigation revealed a single suspicious file named "SecretPictures." When opened, it vanished instantly without leaving a trace, and no antivirus tool could identify it. The IT team isolated the file and provided it for your analysis. As a cybersecurity analyst, your task is to determine what this malware does, how it spreads, and how to stop it before it affects more systems.

### Static Analysis
- Calaculating the hash and virus total scan.
![virus_total](/malware_analysis/SecretPictures/poc_images/virus-total-res.png)

- Getting more information from Detect It Easy or PEStudio
![die](/malware_analysis/SecretPictures/poc_images/compiler_used.png)

- We can also run strings or floss on the binary and analyze the result from there.

### Dynamic Analysis
For Dynamic analysis we are going to do following things so that we can capture what the binary is doing in the machine.
- Run Regshot: run regshot and take a snap before detonating the malware and take one after, regshot have the capability to check and show diff result.
- Run procmon and add a filter which looks for a process name which is "secretPictures".
- Enable wireshark for analyzing the network traffic

Now we can launch the malware and analyze the working that is going on when the malware is launched. We can notice the following things
- we can see that the malware reads the main binary and then writes it successfully on the disk.
![file-copy](/malware_analysis/SecretPictures/poc_images/file-copy.png)
![writing-file](/malware_analysis/SecretPictures/poc_images/reading_writing_file.png)
- It also changes a registry so as to enstablish persistence.
![persistence](/malware_analysis/SecretPictures/poc_images/persistence.png)
- Just as mentioned the malware also deletes itself from the initial location.

### Advanced Static Analysis
Here we are going to disassemble and decompile the binary for getting more insights by analyzing the machine level code.\
Following is the information that we can identify from this phase
- In the main block section of the code there is a function named **main_touchBase**, the name suggests that is something to do with the connection check. While checking we can see that the malware is trying to communicate to a domain name.\
We can also see the encoding that is being used with the web connect method.
![fqdn](/malware_analysis/SecretPictures/poc_images/fqdn.png)
![encoding_used](/malware_analysis/SecretPictures/poc_images/encoding_used.png)
- We can also confirm the persistence from this part. We can see the same registry under **main_lurk** method.
![regedit](/malware_analysis/SecretPictures/poc_images/regedit_modify.png)
- The **main_outbreak** function contians the code which is being used while interacting with the disk, it uses golang internals for getting drive information, and also calls function which checks for a file.
![drivetype](/malware_analysis/SecretPictures/poc_images/drivetype_1.png)
- There is a method named **maine_repeat**, the name suggests this has something to do with the way the malware is being executed repeatedly. Golang as a method under time package which is being used for this purpose.
![periodic](/malware_analysis/SecretPictures/poc_images/periodic_event.png)

- In the heist method we can see multiple functions being called.
    - First we can see a method named **main_collectdata** which internally calls two methods which collects two information.
    - Then we see a post call being made, with this we can conclude that some internal information is being collected and sent out. The information being sent out is related with the machine

![call_stack_1](/malware_analysis/SecretPictures/poc_images/post_call_stack_1.png)
![call_stack_2](/malware_analysis/SecretPictures/poc_images/post_call_stack_2.png)
![call_stack_3](post_call_stack_3.png)
![call_stack_4](post_call_stack_4.png)

**COMPLETE**
